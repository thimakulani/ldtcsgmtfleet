<?php
// This script and data application were generated by AppGini 22.13
// Download AppGini for free from https://bigprof.com/appgini/download/

	include_once(__DIR__ . '/lib.php');
	@include_once(__DIR__ . '/hooks/breakdown_services.php');
	include_once(__DIR__ . '/breakdown_services_dml.php');

	// mm: can the current member access this page?
	$perm = getTablePermissions('breakdown_services');
	if(!$perm['access']) {
		echo error_message($Translation['tableAccessDenied']);
		exit;
	}

	$x = new DataList;
	$x->TableName = 'breakdown_services';

	// Fields that can be displayed in the table view
	$x->QueryFieldsTV = [
		"`breakdown_services`.`breakdown_id`" => "breakdown_id",
		"`breakdown_services`.`breakdown_of_vehicle`" => "breakdown_of_vehicle",
		"`breakdown_services`.`breakdown_during_office_hours`" => "breakdown_during_office_hours",
		"`breakdown_services`.`breakdown_within_or_outside_the_province`" => "breakdown_within_or_outside_the_province",
		"IF(    CHAR_LENGTH(`reception1`.`description_of_vehicle_breakdown_notes`), CONCAT_WS('',   `reception1`.`description_of_vehicle_breakdown_notes`), '') /* Description of Vehicle Breakdown (Notes): */" => "description_of_vehicle_breakdown_notes",
		"`breakdown_services`.`description_of_vehicle_breakdown`" => "description_of_vehicle_breakdown",
		"DATE_FORMAT(`breakdown_services`.`date_of_vehicle_breakdown`, '%D %b %Y %l:%i%p')" => "date_of_vehicle_breakdown",
		"IF(    CHAR_LENGTH(`work_allocation1`.`work_allocation_reference_number`), CONCAT_WS('',   `work_allocation1`.`work_allocation_reference_number`), '') /* Work Allocation Reference Number: */" => "work_allocation_reference_number",
		"IF(    CHAR_LENGTH(`reception2`.`job_card_number`), CONCAT_WS('',   `reception2`.`job_card_number`), '') /* Job Card Number: */" => "job_card_number",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`), CONCAT_WS('',   `gmt_fleet_register1`.`vehicle_registration_number`, '  |   and   |     ', `gmt_fleet_register1`.`engine_number`), '') /* Registration Number: */" => "vehicle_registration_number",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`chassis_number`), CONCAT_WS('',   `gmt_fleet_register1`.`engine_number`, '   |  and  |   ', `gmt_fleet_register1`.`chassis_number`), '') /* Engine Number: */" => "engine_number",
		"IF(    CHAR_LENGTH(`log_sheet1`.`closing_km`), CONCAT_WS('',   `log_sheet1`.`closing_km`), '') /* Closing KM: */" => "closing_km",
		"if(`breakdown_services`.`date_of_vehicle_reactivation`,date_format(`breakdown_services`.`date_of_vehicle_reactivation`,'%d/%m/%Y'),'')" => "date_of_vehicle_reactivation",
		"`breakdown_services`.`type_of_expenditure`" => "type_of_expenditure",
		"`breakdown_services`.`labour_category`" => "labour_category",
		"IF(    CHAR_LENGTH(`parts1`.`part_number`), CONCAT_WS('',   `parts1`.`part_number`), '') /* Part Number (1): */" => "part_number",
		"IF(    CHAR_LENGTH(`parts2`.`part_name`), CONCAT_WS('',   `parts2`.`part_name`), '') /* Part Name (1): */" => "part_name",
		"IF(    CHAR_LENGTH(`manufacturer1`.`manufacturer_name`), CONCAT_WS('',   `manufacturer1`.`manufacturer_name`), '') /* Part Manufacturer Name (1): */" => "part_manufacturer_name",
		"`breakdown_services`.`quantity`" => "quantity",
		"`breakdown_services`.`expense_of_item`" => "expense_of_item",
		"`breakdown_services`.`labour_category_1`" => "labour_category_1",
		"IF(    CHAR_LENGTH(`parts3`.`part_number`), CONCAT_WS('',   `parts3`.`part_number`), '') /* Part Number (2): */" => "part_number_1",
		"IF(    CHAR_LENGTH(`parts4`.`part_name`), CONCAT_WS('',   `parts4`.`part_name`), '') /* Part Name (2): */" => "part_name_1",
		"IF(    CHAR_LENGTH(`manufacturer2`.`manufacturer_name`), CONCAT_WS('',   `manufacturer2`.`manufacturer_name`), '') /* Part Manufacturer Name (2): */" => "part_manufacturer_name_1",
		"`breakdown_services`.`quantity_1`" => "quantity_1",
		"`breakdown_services`.`expense_of_item_1`" => "expense_of_item_1",
		"`breakdown_services`.`material_cost`" => "material_cost",
		"`breakdown_services`.`average_worktime_hrs`" => "average_worktime_hrs",
		"`breakdown_services`.`standard_labour_cost_per_hour`" => "standard_labour_cost_per_hour",
		"`breakdown_services`.`labour_charges`" => "labour_charges",
		"`breakdown_services`.`vat`" => "vat",
		"`breakdown_services`.`total_amount`" => "total_amount",
		"IF(    CHAR_LENGTH(`service1`.`workshop_name`), CONCAT_WS('',   `service1`.`workshop_name`), '') /* Workshop Name: */" => "workshop_name",
		"`breakdown_services`.`work_order_status`" => "work_order_status",
		"`breakdown_services`.`comments`" => "comments",
		"`breakdown_services`.`upload_invoice`" => "upload_invoice",
		"IF(    CHAR_LENGTH(`reception1`.`reception_name_and_surname`), CONCAT_WS('',   `reception1`.`reception_name_and_surname`), '') /* Receptionist Name & Surname: */" => "receptionist",
		"IF(    CHAR_LENGTH(`reception1`.`reception_email_address`), CONCAT_WS('',   `reception1`.`reception_email_address`), '') /* Receptionist Contact e-Mail: */" => "receptionist_contact_email",
		"DATE_FORMAT(`breakdown_services`.`date_captured`, '%e/%c/%Y %l:%i%p')" => "date_captured",
	];
	// mapping incoming sort by requests to actual query fields
	$x->SortFields = [
		1 => '`breakdown_services`.`breakdown_id`',
		2 => 2,
		3 => 3,
		4 => 4,
		5 => '`reception1`.`description_of_vehicle_breakdown_notes`',
		6 => 6,
		7 => '`breakdown_services`.`date_of_vehicle_breakdown`',
		8 => '`work_allocation1`.`work_allocation_reference_number`',
		9 => '`reception2`.`job_card_number`',
		10 => 10,
		11 => 11,
		12 => '`log_sheet1`.`closing_km`',
		13 => '`breakdown_services`.`date_of_vehicle_reactivation`',
		14 => 14,
		15 => 15,
		16 => '`parts1`.`part_number`',
		17 => '`parts2`.`part_name`',
		18 => '`manufacturer1`.`manufacturer_name`',
		19 => 19,
		20 => '`breakdown_services`.`expense_of_item`',
		21 => 21,
		22 => '`parts3`.`part_number`',
		23 => '`parts4`.`part_name`',
		24 => '`manufacturer2`.`manufacturer_name`',
		25 => 25,
		26 => '`breakdown_services`.`expense_of_item_1`',
		27 => '`breakdown_services`.`material_cost`',
		28 => 28,
		29 => '`breakdown_services`.`standard_labour_cost_per_hour`',
		30 => '`breakdown_services`.`labour_charges`',
		31 => '`breakdown_services`.`vat`',
		32 => '`breakdown_services`.`total_amount`',
		33 => 33,
		34 => 34,
		35 => 35,
		36 => 36,
		37 => '`reception1`.`reception_name_and_surname`',
		38 => '`reception1`.`reception_email_address`',
		39 => '`breakdown_services`.`date_captured`',
	];

	// Fields that can be displayed in the csv file
	$x->QueryFieldsCSV = [
		"`breakdown_services`.`breakdown_id`" => "breakdown_id",
		"`breakdown_services`.`breakdown_of_vehicle`" => "breakdown_of_vehicle",
		"`breakdown_services`.`breakdown_during_office_hours`" => "breakdown_during_office_hours",
		"`breakdown_services`.`breakdown_within_or_outside_the_province`" => "breakdown_within_or_outside_the_province",
		"IF(    CHAR_LENGTH(`reception1`.`description_of_vehicle_breakdown_notes`), CONCAT_WS('',   `reception1`.`description_of_vehicle_breakdown_notes`), '') /* Description of Vehicle Breakdown (Notes): */" => "description_of_vehicle_breakdown_notes",
		"`breakdown_services`.`description_of_vehicle_breakdown`" => "description_of_vehicle_breakdown",
		"DATE_FORMAT(`breakdown_services`.`date_of_vehicle_breakdown`, '%D %b %Y %l:%i%p')" => "date_of_vehicle_breakdown",
		"IF(    CHAR_LENGTH(`work_allocation1`.`work_allocation_reference_number`), CONCAT_WS('',   `work_allocation1`.`work_allocation_reference_number`), '') /* Work Allocation Reference Number: */" => "work_allocation_reference_number",
		"IF(    CHAR_LENGTH(`reception2`.`job_card_number`), CONCAT_WS('',   `reception2`.`job_card_number`), '') /* Job Card Number: */" => "job_card_number",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`), CONCAT_WS('',   `gmt_fleet_register1`.`vehicle_registration_number`, '  |   and   |     ', `gmt_fleet_register1`.`engine_number`), '') /* Registration Number: */" => "vehicle_registration_number",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`chassis_number`), CONCAT_WS('',   `gmt_fleet_register1`.`engine_number`, '   |  and  |   ', `gmt_fleet_register1`.`chassis_number`), '') /* Engine Number: */" => "engine_number",
		"IF(    CHAR_LENGTH(`log_sheet1`.`closing_km`), CONCAT_WS('',   `log_sheet1`.`closing_km`), '') /* Closing KM: */" => "closing_km",
		"if(`breakdown_services`.`date_of_vehicle_reactivation`,date_format(`breakdown_services`.`date_of_vehicle_reactivation`,'%d/%m/%Y'),'')" => "date_of_vehicle_reactivation",
		"`breakdown_services`.`type_of_expenditure`" => "type_of_expenditure",
		"`breakdown_services`.`labour_category`" => "labour_category",
		"IF(    CHAR_LENGTH(`parts1`.`part_number`), CONCAT_WS('',   `parts1`.`part_number`), '') /* Part Number (1): */" => "part_number",
		"IF(    CHAR_LENGTH(`parts2`.`part_name`), CONCAT_WS('',   `parts2`.`part_name`), '') /* Part Name (1): */" => "part_name",
		"IF(    CHAR_LENGTH(`manufacturer1`.`manufacturer_name`), CONCAT_WS('',   `manufacturer1`.`manufacturer_name`), '') /* Part Manufacturer Name (1): */" => "part_manufacturer_name",
		"`breakdown_services`.`quantity`" => "quantity",
		"`breakdown_services`.`expense_of_item`" => "expense_of_item",
		"`breakdown_services`.`labour_category_1`" => "labour_category_1",
		"IF(    CHAR_LENGTH(`parts3`.`part_number`), CONCAT_WS('',   `parts3`.`part_number`), '') /* Part Number (2): */" => "part_number_1",
		"IF(    CHAR_LENGTH(`parts4`.`part_name`), CONCAT_WS('',   `parts4`.`part_name`), '') /* Part Name (2): */" => "part_name_1",
		"IF(    CHAR_LENGTH(`manufacturer2`.`manufacturer_name`), CONCAT_WS('',   `manufacturer2`.`manufacturer_name`), '') /* Part Manufacturer Name (2): */" => "part_manufacturer_name_1",
		"`breakdown_services`.`quantity_1`" => "quantity_1",
		"`breakdown_services`.`expense_of_item_1`" => "expense_of_item_1",
		"`breakdown_services`.`material_cost`" => "material_cost",
		"`breakdown_services`.`average_worktime_hrs`" => "average_worktime_hrs",
		"`breakdown_services`.`standard_labour_cost_per_hour`" => "standard_labour_cost_per_hour",
		"`breakdown_services`.`labour_charges`" => "labour_charges",
		"`breakdown_services`.`vat`" => "vat",
		"`breakdown_services`.`total_amount`" => "total_amount",
		"IF(    CHAR_LENGTH(`service1`.`workshop_name`), CONCAT_WS('',   `service1`.`workshop_name`), '') /* Workshop Name: */" => "workshop_name",
		"`breakdown_services`.`work_order_status`" => "work_order_status",
		"`breakdown_services`.`comments`" => "comments",
		"`breakdown_services`.`upload_invoice`" => "upload_invoice",
		"IF(    CHAR_LENGTH(`reception1`.`reception_name_and_surname`), CONCAT_WS('',   `reception1`.`reception_name_and_surname`), '') /* Receptionist Name & Surname: */" => "receptionist",
		"IF(    CHAR_LENGTH(`reception1`.`reception_email_address`), CONCAT_WS('',   `reception1`.`reception_email_address`), '') /* Receptionist Contact e-Mail: */" => "receptionist_contact_email",
		"DATE_FORMAT(`breakdown_services`.`date_captured`, '%e/%c/%Y %l:%i%p')" => "date_captured",
	];
	// Fields that can be filtered
	$x->QueryFieldsFilters = [
		"`breakdown_services`.`breakdown_id`" => "Breakdown ID:",
		"`breakdown_services`.`breakdown_of_vehicle`" => "Breakdown of Vehicle?:",
		"`breakdown_services`.`breakdown_during_office_hours`" => "Breakdown During Office Hours:",
		"`breakdown_services`.`breakdown_within_or_outside_the_province`" => "Breakdown Within or Outside The Province:",
		"IF(    CHAR_LENGTH(`reception1`.`description_of_vehicle_breakdown_notes`), CONCAT_WS('',   `reception1`.`description_of_vehicle_breakdown_notes`), '') /* Description of Vehicle Breakdown (Notes): */" => "Description of Vehicle Breakdown (Notes):",
		"`breakdown_services`.`description_of_vehicle_breakdown`" => "Description of vehicle breakdown",
		"`breakdown_services`.`date_of_vehicle_breakdown`" => "Date of Vehicle Breakdown:",
		"IF(    CHAR_LENGTH(`work_allocation1`.`work_allocation_reference_number`), CONCAT_WS('',   `work_allocation1`.`work_allocation_reference_number`), '') /* Work Allocation Reference Number: */" => "Work Allocation Reference Number:",
		"IF(    CHAR_LENGTH(`reception2`.`job_card_number`), CONCAT_WS('',   `reception2`.`job_card_number`), '') /* Job Card Number: */" => "Job Card Number:",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`), CONCAT_WS('',   `gmt_fleet_register1`.`vehicle_registration_number`, '  |   and   |     ', `gmt_fleet_register1`.`engine_number`), '') /* Registration Number: */" => "Registration Number:",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`chassis_number`), CONCAT_WS('',   `gmt_fleet_register1`.`engine_number`, '   |  and  |   ', `gmt_fleet_register1`.`chassis_number`), '') /* Engine Number: */" => "Engine Number:",
		"IF(    CHAR_LENGTH(`log_sheet1`.`closing_km`), CONCAT_WS('',   `log_sheet1`.`closing_km`), '') /* Closing KM: */" => "Closing KM:",
		"`breakdown_services`.`date_of_vehicle_reactivation`" => "Date of Vehicle Re-activation:",
		"`breakdown_services`.`type_of_expenditure`" => "Type of Expenditure:",
		"`breakdown_services`.`labour_category`" => "Labour Category (1) :",
		"IF(    CHAR_LENGTH(`parts1`.`part_number`), CONCAT_WS('',   `parts1`.`part_number`), '') /* Part Number (1): */" => "Part Number (1):",
		"IF(    CHAR_LENGTH(`parts2`.`part_name`), CONCAT_WS('',   `parts2`.`part_name`), '') /* Part Name (1): */" => "Part Name (1):",
		"IF(    CHAR_LENGTH(`manufacturer1`.`manufacturer_name`), CONCAT_WS('',   `manufacturer1`.`manufacturer_name`), '') /* Part Manufacturer Name (1): */" => "Part Manufacturer Name (1):",
		"`breakdown_services`.`quantity`" => "Quantity (1):",
		"`breakdown_services`.`expense_of_item`" => "Expense Of Item 1 (R):",
		"`breakdown_services`.`labour_category_1`" => "Labour Category (2):",
		"IF(    CHAR_LENGTH(`parts3`.`part_number`), CONCAT_WS('',   `parts3`.`part_number`), '') /* Part Number (2): */" => "Part Number (2):",
		"IF(    CHAR_LENGTH(`parts4`.`part_name`), CONCAT_WS('',   `parts4`.`part_name`), '') /* Part Name (2): */" => "Part Name (2):",
		"IF(    CHAR_LENGTH(`manufacturer2`.`manufacturer_name`), CONCAT_WS('',   `manufacturer2`.`manufacturer_name`), '') /* Part Manufacturer Name (2): */" => "Part Manufacturer Name (2):",
		"`breakdown_services`.`quantity_1`" => "Quantity (2):",
		"`breakdown_services`.`expense_of_item_1`" => "Expense Of Item 2 (R):",
		"`breakdown_services`.`material_cost`" => "Material Cost (R):",
		"`breakdown_services`.`average_worktime_hrs`" => "Average Worktime Hrs:",
		"`breakdown_services`.`standard_labour_cost_per_hour`" => "Standard Labour Cost per Hour:",
		"`breakdown_services`.`labour_charges`" => "Labour Charges (R):",
		"`breakdown_services`.`vat`" => "Vat 15 % (R):",
		"`breakdown_services`.`total_amount`" => "Total Amount (R):",
		"IF(    CHAR_LENGTH(`service1`.`workshop_name`), CONCAT_WS('',   `service1`.`workshop_name`), '') /* Workshop Name: */" => "Workshop Name:",
		"`breakdown_services`.`work_order_status`" => "Work Order Status:",
		"`breakdown_services`.`comments`" => "Comments:",
		"`breakdown_services`.`upload_invoice`" => "Documents (Upload Invoice):",
		"IF(    CHAR_LENGTH(`reception1`.`reception_name_and_surname`), CONCAT_WS('',   `reception1`.`reception_name_and_surname`), '') /* Receptionist Name & Surname: */" => "Receptionist Name & Surname:",
		"IF(    CHAR_LENGTH(`reception1`.`reception_email_address`), CONCAT_WS('',   `reception1`.`reception_email_address`), '') /* Receptionist Contact e-Mail: */" => "Receptionist Contact e-Mail:",
		"`breakdown_services`.`date_captured`" => "Date Captured:",
	];

	// Fields that can be quick searched
	$x->QueryFieldsQS = [
		"`breakdown_services`.`breakdown_id`" => "breakdown_id",
		"`breakdown_services`.`breakdown_of_vehicle`" => "breakdown_of_vehicle",
		"`breakdown_services`.`breakdown_during_office_hours`" => "breakdown_during_office_hours",
		"`breakdown_services`.`breakdown_within_or_outside_the_province`" => "breakdown_within_or_outside_the_province",
		"IF(    CHAR_LENGTH(`reception1`.`description_of_vehicle_breakdown_notes`), CONCAT_WS('',   `reception1`.`description_of_vehicle_breakdown_notes`), '') /* Description of Vehicle Breakdown (Notes): */" => "description_of_vehicle_breakdown_notes",
		"`breakdown_services`.`description_of_vehicle_breakdown`" => "description_of_vehicle_breakdown",
		"DATE_FORMAT(`breakdown_services`.`date_of_vehicle_breakdown`, '%D %b %Y %l:%i%p')" => "date_of_vehicle_breakdown",
		"IF(    CHAR_LENGTH(`work_allocation1`.`work_allocation_reference_number`), CONCAT_WS('',   `work_allocation1`.`work_allocation_reference_number`), '') /* Work Allocation Reference Number: */" => "work_allocation_reference_number",
		"IF(    CHAR_LENGTH(`reception2`.`job_card_number`), CONCAT_WS('',   `reception2`.`job_card_number`), '') /* Job Card Number: */" => "job_card_number",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`), CONCAT_WS('',   `gmt_fleet_register1`.`vehicle_registration_number`, '  |   and   |     ', `gmt_fleet_register1`.`engine_number`), '') /* Registration Number: */" => "vehicle_registration_number",
		"IF(    CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`chassis_number`), CONCAT_WS('',   `gmt_fleet_register1`.`engine_number`, '   |  and  |   ', `gmt_fleet_register1`.`chassis_number`), '') /* Engine Number: */" => "engine_number",
		"IF(    CHAR_LENGTH(`log_sheet1`.`closing_km`), CONCAT_WS('',   `log_sheet1`.`closing_km`), '') /* Closing KM: */" => "closing_km",
		"if(`breakdown_services`.`date_of_vehicle_reactivation`,date_format(`breakdown_services`.`date_of_vehicle_reactivation`,'%d/%m/%Y'),'')" => "date_of_vehicle_reactivation",
		"`breakdown_services`.`type_of_expenditure`" => "type_of_expenditure",
		"`breakdown_services`.`labour_category`" => "labour_category",
		"IF(    CHAR_LENGTH(`parts1`.`part_number`), CONCAT_WS('',   `parts1`.`part_number`), '') /* Part Number (1): */" => "part_number",
		"IF(    CHAR_LENGTH(`parts2`.`part_name`), CONCAT_WS('',   `parts2`.`part_name`), '') /* Part Name (1): */" => "part_name",
		"IF(    CHAR_LENGTH(`manufacturer1`.`manufacturer_name`), CONCAT_WS('',   `manufacturer1`.`manufacturer_name`), '') /* Part Manufacturer Name (1): */" => "part_manufacturer_name",
		"`breakdown_services`.`quantity`" => "quantity",
		"`breakdown_services`.`expense_of_item`" => "expense_of_item",
		"`breakdown_services`.`labour_category_1`" => "labour_category_1",
		"IF(    CHAR_LENGTH(`parts3`.`part_number`), CONCAT_WS('',   `parts3`.`part_number`), '') /* Part Number (2): */" => "part_number_1",
		"IF(    CHAR_LENGTH(`parts4`.`part_name`), CONCAT_WS('',   `parts4`.`part_name`), '') /* Part Name (2): */" => "part_name_1",
		"IF(    CHAR_LENGTH(`manufacturer2`.`manufacturer_name`), CONCAT_WS('',   `manufacturer2`.`manufacturer_name`), '') /* Part Manufacturer Name (2): */" => "part_manufacturer_name_1",
		"`breakdown_services`.`quantity_1`" => "quantity_1",
		"`breakdown_services`.`expense_of_item_1`" => "expense_of_item_1",
		"`breakdown_services`.`material_cost`" => "material_cost",
		"`breakdown_services`.`average_worktime_hrs`" => "average_worktime_hrs",
		"`breakdown_services`.`standard_labour_cost_per_hour`" => "standard_labour_cost_per_hour",
		"`breakdown_services`.`labour_charges`" => "labour_charges",
		"`breakdown_services`.`vat`" => "vat",
		"`breakdown_services`.`total_amount`" => "total_amount",
		"IF(    CHAR_LENGTH(`service1`.`workshop_name`), CONCAT_WS('',   `service1`.`workshop_name`), '') /* Workshop Name: */" => "workshop_name",
		"`breakdown_services`.`work_order_status`" => "work_order_status",
		"`breakdown_services`.`comments`" => "comments",
		"`breakdown_services`.`upload_invoice`" => "upload_invoice",
		"IF(    CHAR_LENGTH(`reception1`.`reception_name_and_surname`), CONCAT_WS('',   `reception1`.`reception_name_and_surname`), '') /* Receptionist Name & Surname: */" => "receptionist",
		"IF(    CHAR_LENGTH(`reception1`.`reception_email_address`), CONCAT_WS('',   `reception1`.`reception_email_address`), '') /* Receptionist Contact e-Mail: */" => "receptionist_contact_email",
		"DATE_FORMAT(`breakdown_services`.`date_captured`, '%e/%c/%Y %l:%i%p')" => "date_captured",
	];

	// Lookup fields that can be used as filterers
	$x->filterers = ['description_of_vehicle_breakdown_notes' => 'Description of Vehicle Breakdown (Notes):', 'work_allocation_reference_number' => 'Work Allocation Reference Number:', 'job_card_number' => 'Job Card Number:', 'vehicle_registration_number' => 'Registration Number:', 'closing_km' => 'Closing KM:', 'part_number' => 'Part Number (1):', 'part_name' => 'Part Name (1):', 'part_manufacturer_name' => 'Part Manufacturer Name (1):', 'part_number_1' => 'Part Number (2):', 'part_name_1' => 'Part Name (2):', 'part_manufacturer_name_1' => 'Part Manufacturer Name (2):', 'workshop_name' => 'Workshop Name:', ];

	$x->QueryFrom = "`breakdown_services` LEFT JOIN `reception` as reception1 ON `reception1`.`reception_user_id`=`breakdown_services`.`description_of_vehicle_breakdown_notes` LEFT JOIN `work_allocation` as work_allocation1 ON `work_allocation1`.`work_allocation_id`=`breakdown_services`.`work_allocation_reference_number` LEFT JOIN `reception` as reception2 ON `reception2`.`reception_user_id`=`breakdown_services`.`job_card_number` LEFT JOIN `gmt_fleet_register` as gmt_fleet_register1 ON `gmt_fleet_register1`.`fleet_asset_id`=`breakdown_services`.`vehicle_registration_number` LEFT JOIN `log_sheet` as log_sheet1 ON `log_sheet1`.`fuel_log_sheet_id`=`breakdown_services`.`closing_km` LEFT JOIN `parts` as parts1 ON `parts1`.`parts_id`=`breakdown_services`.`part_number` LEFT JOIN `parts` as parts2 ON `parts2`.`parts_id`=`breakdown_services`.`part_name` LEFT JOIN `manufacturer` as manufacturer1 ON `manufacturer1`.`manufacturer_id`=`breakdown_services`.`part_manufacturer_name` LEFT JOIN `parts` as parts3 ON `parts3`.`parts_id`=`breakdown_services`.`part_number_1` LEFT JOIN `parts` as parts4 ON `parts4`.`parts_id`=`breakdown_services`.`part_name_1` LEFT JOIN `manufacturer` as manufacturer2 ON `manufacturer2`.`manufacturer_id`=`breakdown_services`.`part_manufacturer_name_1` LEFT JOIN `service` as service1 ON `service1`.`service_id`=`breakdown_services`.`workshop_name` ";
	$x->QueryWhere = '';
	$x->QueryOrder = '';

	$x->AllowSelection = 1;
	$x->HideTableView = ($perm['view'] == 0 ? 1 : 0);
	$x->AllowDelete = $perm['delete'];
	$x->AllowMassDelete = (getLoggedAdmin() !== false);
	$x->AllowInsert = $perm['insert'];
	$x->AllowUpdate = $perm['edit'];
	$x->SeparateDV = 1;
	$x->AllowDeleteOfParents = 0;
	$x->AllowFilters = 1;
	$x->AllowSavingFilters = (getLoggedAdmin() !== false);
	$x->AllowSorting = 1;
	$x->AllowNavigation = 1;
	$x->AllowPrinting = 1;
	$x->AllowPrintingDV = 1;
	$x->AllowCSV = 1;
	$x->RecordsPerPage = 25;
	$x->QuickSearch = 1;
	$x->QuickSearchText = $Translation['quick search'];
	$x->ScriptFileName = 'breakdown_services_view.php';
	$x->RedirectAfterInsert = 'breakdown_services_view.php?SelectedID=#ID#';
	$x->TableTitle = 'Breakdown Services:';
	$x->TableIcon = 'resources/table_icons/breakdowns.png';
	$x->PrimaryKey = '`breakdown_services`.`breakdown_id`';

	$x->ColWidth = [150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 80, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, 150, ];
	$x->ColCaption = ['Breakdown ID:', 'Breakdown of Vehicle?:', 'Breakdown During Office Hours:', 'Breakdown Within or Outside The Province:', 'Description of Vehicle Breakdown (Notes):', 'Description of vehicle breakdown', 'Date of Vehicle Breakdown:', 'Work Allocation Reference Number:', 'Job Card Number:', 'Registration Number:', 'Engine Number:', 'Closing KM:', 'Date of Vehicle Re-activation:', 'Type of Expenditure:', 'Labour Category (1) :', 'Part Number (1):', 'Part Name (1):', 'Part Manufacturer Name (1):', 'Quantity (1):', 'Expense Of Item 1 (R):', 'Labour Category (2):', 'Part Number (2):', 'Part Name (2):', 'Part Manufacturer Name (2):', 'Quantity (2):', 'Expense Of Item 2 (R):', 'Material Cost (R):', 'Average Worktime Hrs:', 'Standard Labour Cost per Hour:', 'Labour Charges (R):', 'Vat 15 % (R):', 'Total Amount (R):', 'Workshop Name:', 'Work Order Status:', 'Comments:', 'Documents (Upload Invoice):', 'Receptionist Name & Surname:', 'Receptionist Contact e-Mail:', 'Date Captured:', ];
	$x->ColFieldName = ['breakdown_id', 'breakdown_of_vehicle', 'breakdown_during_office_hours', 'breakdown_within_or_outside_the_province', 'description_of_vehicle_breakdown_notes', 'description_of_vehicle_breakdown', 'date_of_vehicle_breakdown', 'work_allocation_reference_number', 'job_card_number', 'vehicle_registration_number', 'engine_number', 'closing_km', 'date_of_vehicle_reactivation', 'type_of_expenditure', 'labour_category', 'part_number', 'part_name', 'part_manufacturer_name', 'quantity', 'expense_of_item', 'labour_category_1', 'part_number_1', 'part_name_1', 'part_manufacturer_name_1', 'quantity_1', 'expense_of_item_1', 'material_cost', 'average_worktime_hrs', 'standard_labour_cost_per_hour', 'labour_charges', 'vat', 'total_amount', 'workshop_name', 'work_order_status', 'comments', 'upload_invoice', 'receptionist', 'receptionist_contact_email', 'date_captured', ];
	$x->ColNumber  = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, ];

	// template paths below are based on the app main directory
	$x->Template = 'templates/breakdown_services_templateTV.html';
	$x->SelectedTemplate = 'templates/breakdown_services_templateTVS.html';
	$x->TemplateDV = 'templates/breakdown_services_templateDV.html';
	$x->TemplateDVP = 'templates/breakdown_services_templateDVP.html';

	$x->ShowTableHeader = 1;
	$x->TVClasses = "";
	$x->DVClasses = "";
	$x->HasCalculatedFields = false;
	$x->AllowConsoleLog = false;
	$x->AllowDVNavigation = true;

	// hook: breakdown_services_init
	$render = true;
	if(function_exists('breakdown_services_init')) {
		$args = [];
		$render = breakdown_services_init($x, getMemberInfo(), $args);
	}

	if($render) $x->Render();

	// column sums
	if(strpos($x->HTML, '<!-- tv data below -->')) {
		// if printing multi-selection TV, calculate the sum only for the selected records
		$record_selector = Request::val('record_selector');
		if(Request::val('Print_x') && is_array($record_selector)) {
			$QueryWhere = '';
			foreach($record_selector as $id) {   // get selected records
				if($id != '') $QueryWhere .= "'" . makeSafe($id) . "',";
			}
			if($QueryWhere != '') {
				$QueryWhere = 'where `breakdown_services`.`breakdown_id` in ('.substr($QueryWhere, 0, -1).')';
			} else { // if no selected records, write the where clause to return an empty result
				$QueryWhere = 'where 1=0';
			}
		} else {
			$QueryWhere = $x->QueryWhere;
		}

		$sumQuery = "SELECT SUM(`breakdown_services`.`total_amount`) FROM {$x->QueryFrom} {$QueryWhere}";
		$res = sql($sumQuery, $eo);
		if($row = db_fetch_row($res)) {
			$sumRow = '<tr class="success sum">';
			if(!Request::val('Print_x')) $sumRow .= '<th class="text-center sum">&sum;</th>';
			$sumRow .= '<td class="breakdown_services-breakdown_id sum"></td>';
			$sumRow .= '<td class="breakdown_services-breakdown_of_vehicle sum"></td>';
			$sumRow .= '<td class="breakdown_services-breakdown_during_office_hours sum"></td>';
			$sumRow .= '<td class="breakdown_services-breakdown_within_or_outside_the_province sum"></td>';
			$sumRow .= '<td class="breakdown_services-description_of_vehicle_breakdown_notes sum"></td>';
			$sumRow .= '<td class="breakdown_services-description_of_vehicle_breakdown sum"></td>';
			$sumRow .= '<td class="breakdown_services-date_of_vehicle_breakdown sum"></td>';
			$sumRow .= '<td class="breakdown_services-work_allocation_reference_number sum"></td>';
			$sumRow .= '<td class="breakdown_services-job_card_number sum"></td>';
			$sumRow .= '<td class="breakdown_services-vehicle_registration_number sum"></td>';
			$sumRow .= '<td class="breakdown_services-engine_number sum"></td>';
			$sumRow .= '<td class="breakdown_services-closing_km sum"></td>';
			$sumRow .= '<td class="breakdown_services-date_of_vehicle_reactivation sum"></td>';
			$sumRow .= '<td class="breakdown_services-type_of_expenditure sum"></td>';
			$sumRow .= '<td class="breakdown_services-labour_category sum"></td>';
			$sumRow .= '<td class="breakdown_services-part_number sum"></td>';
			$sumRow .= '<td class="breakdown_services-part_name sum"></td>';
			$sumRow .= '<td class="breakdown_services-part_manufacturer_name sum"></td>';
			$sumRow .= '<td class="breakdown_services-quantity sum"></td>';
			$sumRow .= '<td class="breakdown_services-expense_of_item sum"></td>';
			$sumRow .= '<td class="breakdown_services-labour_category_1 sum"></td>';
			$sumRow .= '<td class="breakdown_services-part_number_1 sum"></td>';
			$sumRow .= '<td class="breakdown_services-part_name_1 sum"></td>';
			$sumRow .= '<td class="breakdown_services-part_manufacturer_name_1 sum"></td>';
			$sumRow .= '<td class="breakdown_services-quantity_1 sum"></td>';
			$sumRow .= '<td class="breakdown_services-expense_of_item_1 sum"></td>';
			$sumRow .= '<td class="breakdown_services-material_cost sum"></td>';
			$sumRow .= '<td class="breakdown_services-average_worktime_hrs sum"></td>';
			$sumRow .= '<td class="breakdown_services-standard_labour_cost_per_hour sum"></td>';
			$sumRow .= '<td class="breakdown_services-labour_charges sum"></td>';
			$sumRow .= '<td class="breakdown_services-vat sum"></td>';
			$sumRow .= "<td class=\"breakdown_services-total_amount text-right sum locale-float\">{$row[0]}</td>";
			$sumRow .= '<td class="breakdown_services-workshop_name sum"></td>';
			$sumRow .= '<td class="breakdown_services-work_order_status sum"></td>';
			$sumRow .= '<td class="breakdown_services-comments sum"></td>';
			$sumRow .= '<td class="breakdown_services-upload_invoice sum"></td>';
			$sumRow .= '<td class="breakdown_services-receptionist sum"></td>';
			$sumRow .= '<td class="breakdown_services-receptionist_contact_email sum"></td>';
			$sumRow .= '<td class="breakdown_services-date_captured sum"></td>';
			$sumRow .= '</tr>';

			$x->HTML = str_replace('<!-- tv data below -->', '', $x->HTML);
			$x->HTML = str_replace('<!-- tv data above -->', $sumRow, $x->HTML);
		}
	}

	// hook: breakdown_services_header
	$headerCode = '';
	if(function_exists('breakdown_services_header')) {
		$args = [];
		$headerCode = breakdown_services_header($x->ContentType, getMemberInfo(), $args);
	}

	if(!$headerCode) {
		include_once(__DIR__ . '/header.php'); 
	} else {
		ob_start();
		include_once(__DIR__ . '/header.php');
		echo str_replace('<%%HEADER%%>', ob_get_clean(), $headerCode);
	}

	echo $x->HTML;

	// hook: breakdown_services_footer
	$footerCode = '';
	if(function_exists('breakdown_services_footer')) {
		$args = [];
		$footerCode = breakdown_services_footer($x->ContentType, getMemberInfo(), $args);
	}

	if(!$footerCode) {
		include_once(__DIR__ . '/footer.php'); 
	} else {
		ob_start();
		include_once(__DIR__ . '/footer.php');
		echo str_replace('<%%FOOTER%%>', ob_get_clean(), $footerCode);
	}
