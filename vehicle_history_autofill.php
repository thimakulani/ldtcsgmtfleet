<?php
// This script and data application were generated by AppGini 22.13
// Download AppGini for free from https://bigprof.com/appgini/download/

	include_once(__DIR__ . '/lib.php');

	handle_maintenance();

	header('Content-type: text/javascript; charset=' . datalist_db_encoding);

	$table_perms = getTablePermissions('vehicle_history');
	if(!$table_perms['access']) die('// Access denied!');

	$mfk = Request::val('mfk');
	$id = makeSafe(Request::val('id'));
	$rnd1 = intval(Request::val('rnd1')); if(!$rnd1) $rnd1 = '';

	if(!$mfk) {
		die('// No js code available!');
	}

	switch($mfk) {

		case 'vehicle_registration_number':
			if(!$id) {
				?>
				$j('#engine_number<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#purchased_price<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#old_registration_number<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#renewal_of_license<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `gmt_fleet_register`.`fleet_asset_id` as 'fleet_asset_id', `gmt_fleet_register`.`vehicle_registration_number` as 'vehicle_registration_number', `gmt_fleet_register`.`register_number` as 'register_number', `gmt_fleet_register`.`engine_number` as 'engine_number', `gmt_fleet_register`.`chassis_number` as 'chassis_number', IF(    CHAR_LENGTH(`dealer1`.`dealer_name`), CONCAT_WS('',   `dealer1`.`dealer_name`), '') as 'dealer_name', IF(    CHAR_LENGTH(`dealer2`.`make_of_vehicle`), CONCAT_WS('',   `dealer2`.`make_of_vehicle`, '   '), '') as 'make_of_vehicle', `gmt_fleet_register`.`model_of_vehicle` as 'model_of_vehicle', IF(    CHAR_LENGTH(`year_model1`.`year_model_specification`), CONCAT_WS('',   `year_model1`.`year_model_specification`), '') as 'year_model_specification', `gmt_fleet_register`.`engine_capacity` as 'engine_capacity', `gmt_fleet_register`.`tyre_size` as 'tyre_size', IF(    CHAR_LENGTH(`transmission1`.`transmission`), CONCAT_WS('',   `transmission1`.`transmission`), '') as 'transmission', IF(    CHAR_LENGTH(`fuel_type1`.`fuel_type`), CONCAT_WS('',   `fuel_type1`.`fuel_type`), '') as 'fuel_type', IF(    CHAR_LENGTH(`body_type1`.`type_of_vehicle`), CONCAT_WS('',   `body_type1`.`type_of_vehicle`), '') as 'type_of_vehicle', IF(    CHAR_LENGTH(`vehicle_colour1`.`colour_of_vehicle`), CONCAT_WS('',   `vehicle_colour1`.`colour_of_vehicle`), '') as 'colour_of_vehicle', IF(    CHAR_LENGTH(`application_status1`.`application_status`), CONCAT_WS('',   `application_status1`.`application_status`), '') as 'application_status', `gmt_fleet_register`.`case_number` as 'case_number', `gmt_fleet_register`.`barcode_number` as 'barcode_number', `gmt_fleet_register`.`purchase_price` as 'purchase_price', `gmt_fleet_register`.`depreciation_value` as 'depreciation_value', `gmt_fleet_register`.`photo_of_vehicle` as 'photo_of_vehicle', `gmt_fleet_register`.`user_name_and_surname` as 'user_name_and_surname', `gmt_fleet_register`.`user_contact_email` as 'user_contact_email', `gmt_fleet_register`.`contact_number` as 'contact_number', IF(    CHAR_LENGTH(`departments1`.`department_name`), CONCAT_WS('',   `departments1`.`department_name`), '') as 'department_name', `gmt_fleet_register`.`department_address` as 'department_address', IF(    CHAR_LENGTH(`province1`.`province`), CONCAT_WS('',   `province1`.`province`), '') as 'province', IF(    CHAR_LENGTH(`districts1`.`district`) || CHAR_LENGTH(`districts1`.`station`), CONCAT_WS('',   `districts1`.`district`, '     |     and     |     ', `districts1`.`station`), '') as 'district', IF(    CHAR_LENGTH(`driver1`.`drivers_name_and_surname`) || CHAR_LENGTH(`driver1`.`drivers_persal_number`), CONCAT_WS('',   `driver1`.`drivers_name_and_surname`, '      |    and    |         ', `driver1`.`drivers_persal_number`), '') as 'drivers_name_and_surname', IF(    CHAR_LENGTH(`driver1`.`drivers_persal_number`), CONCAT_WS('',   `driver1`.`drivers_persal_number`), '') as 'drivers_persal_number', IF(    CHAR_LENGTH(`departments2`.`department_name`), CONCAT_WS('',   `departments2`.`department_name`), '') as 'department_name_of_driver', IF(    CHAR_LENGTH(`driver1`.`drivers_contact_details`), CONCAT_WS('',   `driver1`.`drivers_contact_details`), '') as 'drivers_contact_details', `gmt_fleet_register`.`documents` as 'documents', if(`gmt_fleet_register`.`date_auctioned`,date_format(`gmt_fleet_register`.`date_auctioned`,'%d/%m/%Y'),'') as 'date_auctioned', `gmt_fleet_register`.`venue` as 'venue', `gmt_fleet_register`.`comments` as 'comments', DATE_FORMAT(`gmt_fleet_register`.`renewal_of_license`, '%b %D, %Y %l:%i%p') as 'renewal_of_license', `gmt_fleet_register`.`mm_code` as 'mm_code' FROM `gmt_fleet_register` LEFT JOIN `dealer` as dealer1 ON `dealer1`.`dealer_id`=`gmt_fleet_register`.`dealer_name` LEFT JOIN `dealer` as dealer2 ON `dealer2`.`dealer_id`=`gmt_fleet_register`.`make_of_vehicle` LEFT JOIN `year_model` as year_model1 ON `year_model1`.`year_model_id`=`gmt_fleet_register`.`year_model_specification` LEFT JOIN `transmission` as transmission1 ON `transmission1`.`transmission_id`=`gmt_fleet_register`.`transmission` LEFT JOIN `fuel_type` as fuel_type1 ON `fuel_type1`.`fuel_type_id`=`gmt_fleet_register`.`fuel_type` LEFT JOIN `body_type` as body_type1 ON `body_type1`.`body_type_id`=`gmt_fleet_register`.`type_of_vehicle` LEFT JOIN `vehicle_colour` as vehicle_colour1 ON `vehicle_colour1`.`vehicle_colour_id`=`gmt_fleet_register`.`colour_of_vehicle` LEFT JOIN `application_status` as application_status1 ON `application_status1`.`application_id`=`gmt_fleet_register`.`application_status` LEFT JOIN `departments` as departments1 ON `departments1`.`department_id`=`gmt_fleet_register`.`department_name` LEFT JOIN `province` as province1 ON `province1`.`province_id`=`gmt_fleet_register`.`province` LEFT JOIN `districts` as districts1 ON `districts1`.`district_id`=`gmt_fleet_register`.`district` LEFT JOIN `driver` as driver1 ON `driver1`.`driver_id`=`gmt_fleet_register`.`drivers_name_and_surname` LEFT JOIN `departments` as departments2 ON `departments2`.`department_id`=`gmt_fleet_register`.`department_name_of_driver`  WHERE `gmt_fleet_register`.`fleet_asset_id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#engine_number<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['engine_number']))); ?>&nbsp;');
			$j('#purchased_price<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['purchase_price']))); ?>&nbsp;');
			$j('#old_registration_number<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['vehicle_registration_number'].'   |  and  |   '.$row['engine_number']))); ?>&nbsp;');
			$j('#renewal_of_license<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['renewal_of_license']))); ?>&nbsp;');
			<?php
			break;

		case 'date_of_service':
			if(!$id) {
				?>
				$j('#date_of_next_service<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `service`.`service_id` as 'service_id', `service`.`breakdown_of_vehicle` as 'breakdown_of_vehicle', `service`.`service_title` as 'service_title', IF(    CHAR_LENGTH(`service_item_type1`.`service_item_type`), CONCAT_WS('',   `service_item_type1`.`service_item_type`), '') as 'service_item_type', IF(    CHAR_LENGTH(`service_categories1`.`service_category`), CONCAT_WS('',   `service_categories1`.`service_category`), '') as 'service_category', IF(    CHAR_LENGTH(`merchant1`.`merchant_name`) || CHAR_LENGTH(`merchant_type1`.`merchant_type`), CONCAT_WS('',   `merchant1`.`merchant_name`, '    |   and   |    ', `merchant_type1`.`merchant_type`), '') as 'merchant_name', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`), CONCAT_WS('',   `gmt_fleet_register1`.`vehicle_registration_number`), '') as 'vehicle_registration_number', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`engine_number`), CONCAT_WS('',   `gmt_fleet_register1`.`engine_number`), '') as 'engine_number', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`chassis_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`), CONCAT_WS('',   `gmt_fleet_register1`.`chassis_number`, ' |  and  |     ', `gmt_fleet_register1`.`vehicle_registration_number`), '') as 'chassis_number', IF(    CHAR_LENGTH(`dealer1`.`dealer_name`), CONCAT_WS('',   `dealer1`.`dealer_name`), '') as 'dealer_name', IF(    CHAR_LENGTH(`dealer1`.`make_of_vehicle`), CONCAT_WS('',   `dealer1`.`make_of_vehicle`, '   '), '') as 'make_of_vehicle', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`model_of_vehicle`), CONCAT_WS('',   `gmt_fleet_register1`.`model_of_vehicle`), '') as 'model_of_vehicle', IF(    CHAR_LENGTH(`year_model1`.`year_model_specification`), CONCAT_WS('',   `year_model1`.`year_model_specification`), '') as 'year_model_of_vehicle', IF(    CHAR_LENGTH(`body_type1`.`type_of_vehicle`), CONCAT_WS('',   `body_type1`.`type_of_vehicle`), '') as 'type_of_vehicle', IF(    CHAR_LENGTH(`log_sheet1`.`closing_km`), CONCAT_WS('',   `log_sheet1`.`closing_km`, ' '), '') as 'closing_km', IF(    CHAR_LENGTH(`application_status1`.`application_status`), CONCAT_WS('',   `application_status1`.`application_status`), '') as 'application_status', IF(    CHAR_LENGTH(`work_allocation1`.`work_allocation_reference_number`), CONCAT_WS('',   `work_allocation1`.`work_allocation_reference_number`), '') as 'work_allocation_reference_number', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`barcode_number`), CONCAT_WS('',   `gmt_fleet_register1`.`barcode_number`), '') as 'barcode_number', IF(    CHAR_LENGTH(`departments1`.`department_name`), CONCAT_WS('',   `departments1`.`department_name`), '') as 'department', `service`.`service_item` as 'service_item', IF(    CHAR_LENGTH(if(`schedule1`.`date`,date_format(`schedule1`.`date`,'%d/%m/%Y'),'')), CONCAT_WS('',   if(`schedule1`.`date`,date_format(`schedule1`.`date`,'%d/%m/%Y'),'')), '') as 'date_of_service', IF(    CHAR_LENGTH(`schedule1`.`time`), CONCAT_WS('',   `schedule1`.`time`), '') as 'time', `service`.`upload_quotation` as 'upload_quotation', DATE_FORMAT(`service`.`date_of_next_service`, '%D %b %Y %l:%i%p') as 'date_of_next_service', `service`.`repeat_service_schedule_every_km` as 'repeat_service_schedule_every_km', `service`.`comments` as 'comments', `service`.`upload_invoice` as 'upload_invoice', IF(    CHAR_LENGTH(`reception1`.`reception_name_and_surname`) || CHAR_LENGTH(`reception1`.`reception_persal_number`), CONCAT_WS('',   `reception1`.`reception_name_and_surname`, '     |    and     |     ', `reception1`.`reception_persal_number`), '') as 'receptionist', IF(    CHAR_LENGTH(`reception1`.`reception_email_address`) || CHAR_LENGTH(`reception1`.`reception_contact_details`), CONCAT_WS('',   `reception1`.`reception_email_address`, '     |     and      |    ', `reception1`.`reception_contact_details`), '') as 'receptionist_contact_email', IF(    CHAR_LENGTH(`districts1`.`district`), CONCAT_WS('',   `districts1`.`district`), '') as 'workshop_name', `service`.`workshop_address` as 'workshop_address', `service`.`technician` as 'technician', `service`.`work_order_status` as 'work_order_status', IF(    CHAR_LENGTH(`reception1`.`job_card_number`) || CHAR_LENGTH(`gmt_fleet_register10`.`vehicle_registration_number`), CONCAT_WS('',   `reception1`.`job_card_number`, `gmt_fleet_register10`.`vehicle_registration_number`), '') as 'job_card_number', if(`service`.`completion_date`,date_format(`service`.`completion_date`,'%d/%m/%Y'),'') as 'completion_date', if(`service`.`due_date`,date_format(`service`.`due_date`,'%d/%m/%Y'),'') as 'due_date', DATE_FORMAT(`service`.`filed`, '%c/%e/%Y %l:%i%p') as 'filed', DATE_FORMAT(`service`.`last_modified`, '%c/%e/%Y %l:%i%p') as 'last_modified' FROM `service` LEFT JOIN `service_item_type` as service_item_type1 ON `service_item_type1`.`service_item_type_id`=`service`.`service_item_type` LEFT JOIN `service_categories` as service_categories1 ON `service_categories1`.`service_categories_id`=`service`.`service_category` LEFT JOIN `merchant` as merchant1 ON `merchant1`.`merchant_id`=`service`.`merchant_name` LEFT JOIN `merchant_type` as merchant_type1 ON `merchant_type1`.`merchant_type_id`=`merchant1`.`merchant_type` LEFT JOIN `gmt_fleet_register` as gmt_fleet_register1 ON `gmt_fleet_register1`.`fleet_asset_id`=`service`.`vehicle_registration_number` LEFT JOIN `dealer` as dealer1 ON `dealer1`.`dealer_id`=`service`.`dealer_name` LEFT JOIN `log_sheet` as log_sheet1 ON `log_sheet1`.`fuel_log_sheet_id`=`service`.`closing_km` LEFT JOIN `work_allocation` as work_allocation1 ON `work_allocation1`.`work_allocation_id`=`service`.`work_allocation_reference_number` LEFT JOIN `schedule` as schedule1 ON `schedule1`.`schedule_id`=`service`.`date_of_service` LEFT JOIN `reception` as reception1 ON `reception1`.`reception_user_id`=`service`.`receptionist` LEFT JOIN `year_model` as year_model1 ON `year_model1`.`year_model_id`=`gmt_fleet_register1`.`year_model_specification` LEFT JOIN `body_type` as body_type1 ON `body_type1`.`body_type_id`=`gmt_fleet_register1`.`type_of_vehicle` LEFT JOIN `application_status` as application_status1 ON `application_status1`.`application_id`=`gmt_fleet_register1`.`application_status` LEFT JOIN `departments` as departments1 ON `departments1`.`department_id`=`gmt_fleet_register1`.`department_name` LEFT JOIN `districts` as districts1 ON `districts1`.`district_id`=`reception1`.`district` LEFT JOIN `gmt_fleet_register` as gmt_fleet_register10 ON `gmt_fleet_register10`.`fleet_asset_id`=`reception1`.`vehicle_registration_number`  WHERE `service`.`service_id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#date_of_next_service<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['date_of_next_service']))); ?>&nbsp;');
			<?php
			break;


	}

?>