"use strict";import Axis from"./Axis.js";import H from"./Globals.js";var charts=H.charts,doc=H.doc,seriesTypes=H.seriesTypes,win=H.win;import Legend from"./Legend.js";import MSPointer from"./MSPointer.js";import O from"./Options.js";var defaultOptions=O.defaultOptions;import Pointer from"./Pointer.js";import Time from"./Time.js";import U from"./Utilities.js";var addEvent=U.addEvent,animate=U.animate,animObject=U.animObject,attr=U.attr,createElement=U.createElement,css=U.css,defined=U.defined,discardElement=U.discardElement,erase=U.erase,error=U.error,extend=U.extend,find=U.find,fireEvent=U.fireEvent,getStyle=U.getStyle,isArray=U.isArray,isFunction=U.isFunction,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,merge=U.merge,numberFormat=U.numberFormat,objectEach=U.objectEach,pick=U.pick,pInt=U.pInt,relativeLength=U.relativeLength,removeEvent=U.removeEvent,setAnimation=U.setAnimation,splat=U.splat,syncTimeout=U.syncTimeout,uniqueKey=U.uniqueKey,marginNames=H.marginNames,Chart=function(){function t(t,e,i){this.axes=void 0,this.axisOffset=void 0,this.bounds=void 0,this.chartHeight=void 0,this.chartWidth=void 0,this.clipBox=void 0,this.colorCounter=void 0,this.container=void 0,this.index=void 0,this.isResizing=void 0,this.labelCollectors=void 0,this.legend=void 0,this.margin=void 0,this.numberFormatter=void 0,this.options=void 0,this.plotBox=void 0,this.plotHeight=void 0,this.plotLeft=void 0,this.plotTop=void 0,this.plotWidth=void 0,this.pointCount=void 0,this.pointer=void 0,this.renderer=void 0,this.renderTo=void 0,this.series=void 0,this.spacing=void 0,this.spacingBox=void 0,this.symbolCounter=void 0,this.time=void 0,this.titleOffset=void 0,this.userOptions=void 0,this.xAxis=void 0,this.yAxis=void 0,this.getArgs(t,e,i)}return t.prototype.getArgs=function(t,e,i){isString(t)||t.nodeName?(this.renderTo=t,this.init(e,i)):this.init(t,e)},t.prototype.init=function(t,e){var i,s=t.series,r=t.plotOptions||{};fireEvent(this,"init",{args:arguments},function(){t.series=null;var o=(i=merge(defaultOptions,t)).chart||{};objectEach(i.plotOptions,function(t,e){isObject(t)&&(t.tooltip=r[e]&&merge(r[e].tooltip)||void 0)}),i.tooltip.userOptions=t.chart&&t.chart.forExport&&t.tooltip.userOptions||t.tooltip,i.series=t.series=s,this.userOptions=t;var n=o.events;this.margin=[],this.spacing=[],this.bounds={h:{},v:{}},this.labelCollectors=[],this.callback=e,this.isResizing=0,this.options=i,this.axes=[],this.series=[],this.time=t.time&&Object.keys(t.time).length?new Time(t.time):H.time,this.numberFormatter=o.numberFormatter||numberFormat,this.styledMode=o.styledMode,this.hasCartesianSeries=o.showAxes;var h=this;h.index=charts.length,charts.push(h),H.chartCount++,n&&objectEach(n,function(t,e){isFunction(t)&&addEvent(h,e,t)}),h.xAxis=[],h.yAxis=[],h.pointCount=h.colorCounter=h.symbolCounter=0,fireEvent(h,"afterInit"),h.firstRender()})},t.prototype.initSeries=function(t){var e,i=this.options.chart,s=t.type||i.type||i.defaultSeriesType,r=seriesTypes[s];return r||error(17,!0,this,{missingModuleFor:s}),(e=new r).init(this,t),e},t.prototype.setSeriesData=function(){this.getSeriesOrderByLinks().forEach(function(t){t.points||t.data||!t.enabledDataSorting||t.setData(t.options.data,!1)})},t.prototype.getSeriesOrderByLinks=function(){return this.series.concat().sort(function(t,e){return t.linkedSeries.length||e.linkedSeries.length?e.linkedSeries.length-t.linkedSeries.length:0})},t.prototype.orderSeries=function(t){for(var e=this.series,i=t||0;i<e.length;i++)e[i]&&(e[i].index=i,e[i].name=e[i].getName())},t.prototype.isInsidePlot=function(t,e,i){var s=i?e:t,r=i?t:e,o={x:s,y:r,isInsidePlot:s>=0&&s<=this.plotWidth&&r>=0&&r<=this.plotHeight};return fireEvent(this,"afterIsInsidePlot",o),o.isInsidePlot},t.prototype.redraw=function(t){fireEvent(this,"beforeRedraw");var e,i,s,r,o=this,n=o.axes,h=o.series,a=o.pointer,d=o.legend,l=o.userOptions.legend,c=o.isDirtyLegend,p=o.hasCartesianSeries,f=o.isDirtyBox,g=o.renderer,u=g.isHidden(),y=[];for(o.setResponsive&&o.setResponsive(!1),setAnimation(!!o.hasRendered&&t,o),u&&o.temporaryDisplay(),o.layOutTitles(),s=h.length;s--;)if((r=h[s]).options.stacking&&(e=!0,r.isDirty)){i=!0;break}if(i)for(s=h.length;s--;)(r=h[s]).options.stacking&&(r.isDirty=!0);h.forEach(function(t){t.isDirty&&("point"===t.options.legendType?(t.updateTotals&&t.updateTotals(),c=!0):l&&(l.labelFormatter||l.labelFormat)&&(c=!0)),t.isDirtyData&&fireEvent(t,"updatedData")}),c&&d&&d.options.enabled&&(d.render(),o.isDirtyLegend=!1),e&&o.getStacks(),p&&n.forEach(function(t){o.isResizing&&isNumber(t.min)||(t.updateNames(),t.setScale())}),o.getMargins(),p&&(n.forEach(function(t){t.isDirty&&(f=!0)}),n.forEach(function(t){var i=t.min+","+t.max;t.extKey!==i&&(t.extKey=i,y.push(function(){fireEvent(t,"afterSetExtremes",extend(t.eventArgs,t.getExtremes())),delete t.eventArgs})),(f||e)&&t.redraw()})),f&&o.drawChartBox(),fireEvent(o,"predraw"),h.forEach(function(t){(f||t.isDirty)&&t.visible&&t.redraw(),t.isDirtyData=!1}),a&&a.reset(!0),g.draw(),fireEvent(o,"redraw"),fireEvent(o,"render"),u&&o.temporaryDisplay(!0),y.forEach(function(t){t.call()})},t.prototype.get=function(t){var e,i,s=this.series;function r(e){return e.id===t||e.options&&e.options.id===t}for(e=find(this.axes,r)||find(this.series,r),i=0;!e&&i<s.length;i++)e=find(s[i].points||[],r);return e},t.prototype.getAxes=function(){var t=this,e=this.options,i=e.xAxis=splat(e.xAxis||{}),s=e.yAxis=splat(e.yAxis||{});fireEvent(this,"getAxes"),i.forEach(function(t,e){t.index=e,t.isX=!0}),s.forEach(function(t,e){t.index=e}),i.concat(s).forEach(function(e){new Axis(t,e)}),fireEvent(this,"afterGetAxes")},t.prototype.getSelectedPoints=function(){var t=[];return this.series.forEach(function(e){t=t.concat(e.getPointsCollection().filter(function(t){return pick(t.selectedStaging,t.selected)}))}),t},t.prototype.getSelectedSeries=function(){return this.series.filter(function(t){return t.selected})},t.prototype.setTitle=function(t,e,i){this.applyDescription("title",t),this.applyDescription("subtitle",e),this.applyDescription("caption",void 0),this.layOutTitles(i)},t.prototype.applyDescription=function(t,e){var i=this,s="title"===t?{color:"#333333",fontSize:this.options.isStock?"16px":"18px"}:{color:"#666666"},r=this.options[t]=merge(!this.styledMode&&{style:s},this.options[t],e),o=this[t];o&&e&&(this[t]=o=o.destroy()),r&&!o&&((o=this.renderer.text(r.text,0,0,r.useHTML).attr({align:r.align,class:"highcharts-"+t,zIndex:r.zIndex||4}).add()).update=function(e){i[{title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"}[t]](e)},this.styledMode||o.css(r.style),this[t]=o)},t.prototype.layOutTitles=function(t){var e,i=[0,0,0],s=this.renderer,r=this.spacingBox;["title","subtitle","caption"].forEach(function(t){var e,o,n=this[t],h=this.options[t],a=h.verticalAlign||"top",d="title"===t?-3:"top"===a?i[0]+2:0;n&&(this.styledMode||(e=h.style.fontSize),e=s.fontMetrics(e,n).b,n.css({width:(h.width||r.width+(h.widthAdjust||0))+"px"}),o=Math.round(n.getBBox(h.useHTML).height),n.align(extend({y:"bottom"===a?e:d+e,height:o},h),!1,"spacingBox"),h.floating||("top"===a?i[0]=Math.ceil(i[0]+o):"bottom"===a&&(i[2]=Math.ceil(i[2]+o))))},this),i[0]&&"top"===(this.options.title.verticalAlign||"top")&&(i[0]+=this.options.title.margin),i[2]&&"bottom"===this.options.caption.verticalAlign&&(i[2]+=this.options.caption.margin),e=!this.titleOffset||this.titleOffset.join(",")!==i.join(","),this.titleOffset=i,fireEvent(this,"afterLayOutTitles"),!this.isDirtyBox&&e&&(this.isDirtyBox=this.isDirtyLegend=e,this.hasRendered&&pick(t,!0)&&this.isDirtyBox&&this.redraw())},t.prototype.getChartSize=function(){var t=this.options.chart,e=t.width,i=t.height,s=this.renderTo;defined(e)||(this.containerWidth=getStyle(s,"width")),defined(i)||(this.containerHeight=getStyle(s,"height")),this.chartWidth=Math.max(0,e||this.containerWidth||600),this.chartHeight=Math.max(0,relativeLength(i,this.chartWidth)||(this.containerHeight>1?this.containerHeight:400))},t.prototype.temporaryDisplay=function(t){var e,i=this.renderTo;if(t)for(;i&&i.style;)i.hcOrigStyle&&(css(i,i.hcOrigStyle),delete i.hcOrigStyle),i.hcOrigDetached&&(doc.body.removeChild(i),i.hcOrigDetached=!1),i=i.parentNode;else for(;i&&i.style&&(doc.body.contains(i)||i.parentNode||(i.hcOrigDetached=!0,doc.body.appendChild(i)),("none"===getStyle(i,"display",!1)||i.hcOricDetached)&&(i.hcOrigStyle={display:i.style.display,height:i.style.height,overflow:i.style.overflow},e={display:"block",overflow:"hidden"},i!==this.renderTo&&(e.height=0),css(i,e),i.offsetWidth||i.style.setProperty("display","block","important")),(i=i.parentNode)!==doc.body););},t.prototype.setClassName=function(t){this.container.className="highcharts-container "+(t||"")},t.prototype.getContainer=function(){var t,e,i,s,r,o,n,h=this.options,a=h.chart,d=this.renderTo,l=uniqueKey();if(d||(this.renderTo=d=a.renderTo),isString(d)&&(this.renderTo=d=doc.getElementById(d)),d||error(13,!0,this),s=pInt(attr(d,"data-highcharts-chart")),isNumber(s)&&charts[s]&&charts[s].hasRendered&&charts[s].destroy(),attr(d,"data-highcharts-chart",this.index),d.innerHTML="",a.skipClone||d.offsetWidth||this.temporaryDisplay(),this.getChartSize(),e=this.chartWidth,i=this.chartHeight,css(d,{overflow:"hidden"}),this.styledMode||(o=extend({position:"relative",overflow:"hidden",width:e+"px",height:i+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none"},a.style)),t=createElement("div",{id:l},o,d),this.container=t,this._cursor=t.style.cursor,r=H[a.renderer]||H.Renderer,this.renderer=new r(t,e,i,null,a.forExport,h.exporting&&h.exporting.allowHTML,this.styledMode),setAnimation(void 0,this),this.setClassName(a.className),this.styledMode)for(n in h.defs)this.renderer.definition(h.defs[n]);else this.renderer.setStyle(a.style);this.renderer.chartIndex=this.index,fireEvent(this,"afterGetContainer")},t.prototype.getMargins=function(t){var e=this.spacing,i=this.margin,s=this.titleOffset;this.resetMargins(),s[0]&&!defined(i[0])&&(this.plotTop=Math.max(this.plotTop,s[0]+e[0])),s[2]&&!defined(i[2])&&(this.marginBottom=Math.max(this.marginBottom,s[2]+e[2])),this.legend&&this.legend.display&&this.legend.adjustMargins(i,e),fireEvent(this,"getMargins"),t||this.getAxisMargins()},t.prototype.getAxisMargins=function(){var t=this,e=t.axisOffset=[0,0,0,0],i=t.colorAxis,s=t.margin,r=function(t){t.forEach(function(t){t.visible&&t.getOffset()})};t.hasCartesianSeries?r(t.axes):i&&i.length&&r(i),marginNames.forEach(function(i,r){defined(s[r])||(t[i]+=e[r])}),t.setChartSize()},t.prototype.reflow=function(t){var e=this,i=e.options.chart,s=e.renderTo,r=defined(i.width)&&defined(i.height),o=i.width||getStyle(s,"width"),n=i.height||getStyle(s,"height"),h=t?t.target:win;r||e.isPrinting||!o||!n||h!==win&&h!==doc||(o===e.containerWidth&&n===e.containerHeight||(U.clearTimeout(e.reflowTimeout),e.reflowTimeout=syncTimeout(function(){e.container&&e.setSize(void 0,void 0,!1)},t?100:0)),e.containerWidth=o,e.containerHeight=n)},t.prototype.setReflow=function(t){var e=this;!1===t||this.unbindReflow?!1===t&&this.unbindReflow&&(this.unbindReflow=this.unbindReflow()):(this.unbindReflow=addEvent(win,"resize",function(t){e.options&&e.reflow(t)}),addEvent(this,"destroy",this.unbindReflow))},t.prototype.setSize=function(t,e,i){var s,r=this,o=r.renderer;r.isResizing+=1,setAnimation(i,r),s=o.globalAnimation,r.oldChartHeight=r.chartHeight,r.oldChartWidth=r.chartWidth,void 0!==t&&(r.options.chart.width=t),void 0!==e&&(r.options.chart.height=e),r.getChartSize(),r.styledMode||(s?animate:css)(r.container,{width:r.chartWidth+"px",height:r.chartHeight+"px"},s),r.setChartSize(!0),o.setSize(r.chartWidth,r.chartHeight,s),r.axes.forEach(function(t){t.isDirty=!0,t.setScale()}),r.isDirtyLegend=!0,r.isDirtyBox=!0,r.layOutTitles(),r.getMargins(),r.redraw(s),r.oldChartHeight=null,fireEvent(r,"resize"),syncTimeout(function(){r&&fireEvent(r,"endResize",null,function(){r.isResizing-=1})},animObject(s).duration||0)},t.prototype.setChartSize=function(t){var e,i,s,r,o,n,h,a=this.inverted,d=this.renderer,l=this.chartWidth,c=this.chartHeight,p=this.options.chart,f=this.spacing,g=this.clipOffset;this.plotLeft=s=Math.round(this.plotLeft),this.plotTop=r=Math.round(this.plotTop),this.plotWidth=o=Math.max(0,Math.round(l-s-this.marginRight)),this.plotHeight=n=Math.max(0,Math.round(c-r-this.marginBottom)),this.plotSizeX=a?n:o,this.plotSizeY=a?o:n,this.plotBorderWidth=p.plotBorderWidth||0,this.spacingBox=d.spacingBox={x:f[3],y:f[0],width:l-f[3]-f[1],height:c-f[0]-f[2]},this.plotBox=d.plotBox={x:s,y:r,width:o,height:n},h=2*Math.floor(this.plotBorderWidth/2),e=Math.ceil(Math.max(h,g[3])/2),i=Math.ceil(Math.max(h,g[0])/2),this.clipBox={x:e,y:i,width:Math.floor(this.plotSizeX-Math.max(h,g[1])/2-e),height:Math.max(0,Math.floor(this.plotSizeY-Math.max(h,g[2])/2-i))},t||this.axes.forEach(function(t){t.setAxisSize(),t.setAxisTranslation()}),fireEvent(this,"afterSetChartSize",{skipAxes:t})},t.prototype.resetMargins=function(){fireEvent(this,"resetMargins");var t=this,e=t.options.chart;["margin","spacing"].forEach(function(i){var s=e[i],r=isObject(s)?s:[s,s,s,s];["Top","Right","Bottom","Left"].forEach(function(s,o){t[i][o]=pick(e[i+s],r[o])})}),marginNames.forEach(function(e,i){t[e]=pick(t.margin[i],t.spacing[i])}),t.axisOffset=[0,0,0,0],t.clipOffset=[0,0,0,0]},t.prototype.drawChartBox=function(){var t,e,i,s=this.options.chart,r=this.renderer,o=this.chartWidth,n=this.chartHeight,h=this.chartBackground,a=this.plotBackground,d=this.plotBorder,l=this.styledMode,c=this.plotBGImage,p=s.backgroundColor,f=s.plotBackgroundColor,g=s.plotBackgroundImage,u=this.plotLeft,y=this.plotTop,m=this.plotWidth,v=this.plotHeight,x=this.plotBox,S=this.clipRect,b=this.clipBox,E="animate";h||(this.chartBackground=h=r.rect().addClass("highcharts-background").add(),E="attr"),l?t=e=h.strokeWidth():(e=(t=s.borderWidth||0)+(s.shadow?8:0),i={fill:p||"none"},(t||h["stroke-width"])&&(i.stroke=s.borderColor,i["stroke-width"]=t),h.attr(i).shadow(s.shadow)),h[E]({x:e/2,y:e/2,width:o-e-t%2,height:n-e-t%2,r:s.borderRadius}),E="animate",a||(E="attr",this.plotBackground=a=r.rect().addClass("highcharts-plot-background").add()),a[E](x),l||(a.attr({fill:f||"none"}).shadow(s.plotShadow),g&&(c?(g!==c.attr("href")&&c.attr("href",g),c.animate(x)):this.plotBGImage=r.image(g,u,y,m,v).add())),S?S.animate({width:b.width,height:b.height}):this.clipRect=r.clipRect(b),E="animate",d||(E="attr",this.plotBorder=d=r.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),l||d.attr({stroke:s.plotBorderColor,"stroke-width":s.plotBorderWidth||0,fill:"none"}),d[E](d.crisp({x:u,y:y,width:m,height:v},-d.strokeWidth())),this.isDirtyBox=!1,fireEvent(this,"afterDrawChartBox")},t.prototype.propFromSeries=function(){var t,e,i,s=this,r=s.options.chart,o=s.options.series;["inverted","angular","polar"].forEach(function(n){for(t=seriesTypes[r.type||r.defaultSeriesType],i=r[n]||t&&t.prototype[n],e=o&&o.length;!i&&e--;)(t=seriesTypes[o[e].type])&&t.prototype[n]&&(i=!0);s[n]=i})},t.prototype.linkSeries=function(){var t=this,e=t.series;e.forEach(function(t){t.linkedSeries.length=0}),e.forEach(function(e){var i=e.options.linkedTo;isString(i)&&(i=":previous"===i?t.series[e.index-1]:t.get(i))&&i.linkedParent!==e&&(i.linkedSeries.push(e),e.linkedParent=i,i.enabledDataSorting&&e.setDataSortingOptions(),e.visible=pick(e.options.visible,i.options.visible,e.visible))}),fireEvent(this,"afterLinkSeries")},t.prototype.renderSeries=function(){this.series.forEach(function(t){t.translate(),t.render()})},t.prototype.renderLabels=function(){var t=this,e=t.options.labels;e.items&&e.items.forEach(function(i){var s=extend(e.style,i.style),r=pInt(s.left)+t.plotLeft,o=pInt(s.top)+t.plotTop+12;delete s.left,delete s.top,t.renderer.text(i.html,r,o).attr({zIndex:2}).css(s).add()})},t.prototype.render=function(){var t,e,i,s,r=this.axes,o=this.colorAxis,n=this.renderer,h=this.options,a=0,d=function(t){t.forEach(function(t){t.visible&&t.render()})};this.setTitle(),this.legend=new Legend(this,h.legend),this.getStacks&&this.getStacks(),this.getMargins(!0),this.setChartSize(),t=this.plotWidth,r.some(function(t){if(t.horiz&&t.visible&&t.options.labels.enabled&&t.series.length)return a=21,!0}),this.plotHeight=Math.max(this.plotHeight-a,0),e=this.plotHeight,r.forEach(function(t){t.setScale()}),this.getAxisMargins(),i=t/this.plotWidth>1.1,s=e/this.plotHeight>1.05,(i||s)&&(r.forEach(function(t){(t.horiz&&i||!t.horiz&&s)&&t.setTickInterval(!0)}),this.getMargins()),this.drawChartBox(),this.hasCartesianSeries?d(r):o&&o.length&&d(o),this.seriesGroup||(this.seriesGroup=n.g("series-group").attr({zIndex:3}).add()),this.renderSeries(),this.renderLabels(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.updateContainerScaling(),this.hasRendered=!0},t.prototype.addCredits=function(t){var e=this,i=merge(!0,this.options.credits,t);i.enabled&&!this.credits&&(this.credits=this.renderer.text(i.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){i.href&&(win.location.href=i.href)}).attr({align:i.position.align,zIndex:8}),e.styledMode||this.credits.css(i.style),this.credits.add().align(i.position),this.credits.update=function(t){e.credits=e.credits.destroy(),e.addCredits(t)})},t.prototype.updateContainerScaling=function(){var t=this.container;if(t.offsetWidth>2&&t.offsetHeight>2&&t.getBoundingClientRect){var e=t.getBoundingClientRect(),i=e.width/t.offsetWidth,s=e.height/t.offsetHeight;1!==i||1!==s?this.containerScaling={scaleX:i,scaleY:s}:delete this.containerScaling}},t.prototype.destroy=function(){var t,e=this,i=e.axes,s=e.series,r=e.container,o=r&&r.parentNode;for(fireEvent(e,"destroy"),e.renderer.forExport?erase(charts,e):charts[e.index]=void 0,H.chartCount--,e.renderTo.removeAttribute("data-highcharts-chart"),removeEvent(e),t=i.length;t--;)i[t]=i[t].destroy();for(this.scroller&&this.scroller.destroy&&this.scroller.destroy(),t=s.length;t--;)s[t]=s[t].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(function(t){var i=e[t];i&&i.destroy&&(e[t]=i.destroy())}),r&&(r.innerHTML="",removeEvent(r),o&&discardElement(r)),objectEach(e,function(t,i){delete e[i]})},t.prototype.firstRender=function(){var t=this,e=t.options;t.isReadyToRender&&!t.isReadyToRender()||(t.getContainer(),t.resetMargins(),t.setChartSize(),t.propFromSeries(),t.getAxes(),(isArray(e.series)?e.series:[]).forEach(function(e){t.initSeries(e)}),t.linkSeries(),t.setSeriesData(),fireEvent(t,"beforeRender"),Pointer&&(H.hasTouch||!win.PointerEvent&&!win.MSPointerEvent?t.pointer=new Pointer(t,e):t.pointer=new MSPointer(t,e)),t.render(),t.renderer.imgCount||t.hasLoaded||t.onload(),t.temporaryDisplay(!0))},t.prototype.onload=function(){this.callbacks.concat([this.callback]).forEach(function(t){t&&void 0!==this.index&&t.apply(this,[this])},this),fireEvent(this,"load"),fireEvent(this,"render"),defined(this.index)&&this.setReflow(this.options.chart.reflow),this.hasLoaded=!0},t}();function chart(t,e,i){return new Chart(t,e,i)}Chart.prototype.callbacks=[],H.chart=chart,H.Chart=Chart;export default Chart;