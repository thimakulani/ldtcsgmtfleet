<?php
// This script and data application were generated by AppGini 22.13
// Download AppGini for free from https://bigprof.com/appgini/download/

	include_once(__DIR__ . '/lib.php');

	handle_maintenance();

	header('Content-type: text/javascript; charset=' . datalist_db_encoding);

	$table_perms = getTablePermissions('vehicle_handing_over_checklist');
	if(!$table_perms['access']) die('// Access denied!');

	$mfk = Request::val('mfk');
	$id = makeSafe(Request::val('id'));
	$rnd1 = intval(Request::val('rnd1')); if(!$rnd1) $rnd1 = '';

	if(!$mfk) {
		die('// No js code available!');
	}

	switch($mfk) {

		case 'vehicle_registration_number':
			if(!$id) {
				?>
				$j('#closing_km<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#make_of_vehicle<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#model_of_vehicle<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `log_sheet`.`fuel_log_sheet_id` as 'fuel_log_sheet_id', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`), CONCAT_WS('',   `gmt_fleet_register1`.`vehicle_registration_number`), '') as 'vehicle_registration_number', IF(    CHAR_LENGTH(`gmt_fleet_register2`.`register_number`), CONCAT_WS('',   `gmt_fleet_register2`.`register_number`), '') as 'register_number', IF(    CHAR_LENGTH(`dealer1`.`make_of_vehicle`), CONCAT_WS('',   `dealer1`.`make_of_vehicle`, '   '), '') as 'make_of_vehicle', IF(    CHAR_LENGTH(`gmt_fleet_register3`.`model_of_vehicle`), CONCAT_WS('',   `gmt_fleet_register3`.`model_of_vehicle`), '') as 'model_of_vehicle', IF(    CHAR_LENGTH(`year_model1`.`year_model_specification`), CONCAT_WS('',   `year_model1`.`year_model_specification`), '') as 'year_model_specification', IF(    CHAR_LENGTH(`vehicle_colour1`.`colour_of_vehicle`), CONCAT_WS('',   `vehicle_colour1`.`colour_of_vehicle`), '') as 'colour_of_vehicle', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`engine_capacity`), CONCAT_WS('',   `gmt_fleet_register1`.`engine_capacity`), '') as 'engine_capacity', DATE_FORMAT(`log_sheet`.`renewal_of_license`, '%b %D, %Y %l:%i%p') as 'renewal_of_license', IF(    CHAR_LENGTH(`districts1`.`district`) || CHAR_LENGTH(`districts1`.`station`) || CHAR_LENGTH(`province1`.`province`), CONCAT_WS('',   `districts1`.`district`, '     |     and     |     ', `districts1`.`station`, `province1`.`province`), '') as 'district', DATE_FORMAT(`log_sheet`.`month`, '%D %b %Y %l:%i%p') as 'month', IF(    CHAR_LENGTH(`driver1`.`drivers_name_and_surname`), CONCAT_WS('',   `driver1`.`drivers_name_and_surname`), '') as 'drivers_name_and_surname', IF(    CHAR_LENGTH(`driver1`.`drivers_persal_number`), CONCAT_WS('',   `driver1`.`drivers_persal_number`), '') as 'drivers_persal_number', `log_sheet`.`opening_km` as 'opening_km', `log_sheet`.`total_trip_distance` as 'total_trip_distance', `log_sheet`.`closing_km` as 'closing_km', IF(    CHAR_LENGTH(`fuel_type1`.`fuel_type`), CONCAT_WS('',   `fuel_type1`.`fuel_type`), '') as 'fuel_type', `log_sheet`.`fuel_tank_capacity` as 'fuel_tank_capacity', `log_sheet`.`vendor` as 'vendor', `log_sheet`.`fuel_cost_litre` as 'fuel_cost_litre', `log_sheet`.`refuel_quantity_1` as 'refuel_quantity_1', if(`log_sheet`.`refuel_first_time_date`,date_format(`log_sheet`.`refuel_first_time_date`,'%d/%m/%Y'),'') as 'refuel_first_time_date', `log_sheet`.`trip_distance_refuel_1` as 'trip_distance_refuel_1', `log_sheet`.`refuel_quantity_2` as 'refuel_quantity_2', if(`log_sheet`.`refuel_second_time_date`,date_format(`log_sheet`.`refuel_second_time_date`,'%d/%m/%Y'),'') as 'refuel_second_time_date', `log_sheet`.`trip_distance_refuel_2` as 'trip_distance_refuel_2', `log_sheet`.`refuel_quantity_3` as 'refuel_quantity_3', if(`log_sheet`.`refuel_third_time_date`,date_format(`log_sheet`.`refuel_third_time_date`,'%d/%m/%Y'),'') as 'refuel_third_time_date', `log_sheet`.`trip_distance_refuel_3` as 'trip_distance_refuel_3', `log_sheet`.`refuel_quantity_4` as 'refuel_quantity_4', if(`log_sheet`.`refuel_fourth_time_date`,date_format(`log_sheet`.`refuel_fourth_time_date`,'%d/%m/%Y'),'') as 'refuel_fourth_time_date', `log_sheet`.`trip_distance_refuel_4` as 'trip_distance_refuel_4', `log_sheet`.`refuel_quantity_5` as 'refuel_quantity_5', if(`log_sheet`.`refuel_fifth_time_date`,date_format(`log_sheet`.`refuel_fifth_time_date`,'%d/%m/%Y'),'') as 'refuel_fifth_time_date', `log_sheet`.`trip_distance_refuel_5` as 'trip_distance_refuel_5', `log_sheet`.`refuel_quantity_6` as 'refuel_quantity_6', `log_sheet`.`trip_distance_refuel_6` as 'trip_distance_refuel_6', if(`log_sheet`.`refuel_sixth_time_date`,date_format(`log_sheet`.`refuel_sixth_time_date`,'%d/%m/%Y'),'') as 'refuel_sixth_time_date', `log_sheet`.`times_refuel_current_month` as 'times_refuel_current_month', `log_sheet`.`total_fuel_quantity` as 'total_fuel_quantity', `log_sheet`.`fuel_consumption` as 'fuel_consumption', `log_sheet`.`fuel_total_cost` as 'fuel_total_cost', `log_sheet`.`payment_e_fuel_card` as 'payment_e_fuel_card', `log_sheet`.`captured_by` as 'captured_by', `log_sheet`.`comments` as 'comments', DATE_FORMAT(`log_sheet`.`date_captured`, '%e/%c/%Y %l:%i%p') as 'date_captured', `log_sheet`.`complete_fill_up` as 'complete_fill_up' FROM `log_sheet` LEFT JOIN `gmt_fleet_register` as gmt_fleet_register1 ON `gmt_fleet_register1`.`fleet_asset_id`=`log_sheet`.`vehicle_registration_number` LEFT JOIN `gmt_fleet_register` as gmt_fleet_register2 ON `gmt_fleet_register2`.`fleet_asset_id`=`log_sheet`.`register_number` LEFT JOIN `gmt_fleet_register` as gmt_fleet_register3 ON `gmt_fleet_register3`.`fleet_asset_id`=`log_sheet`.`model_of_vehicle` LEFT JOIN `vehicle_colour` as vehicle_colour1 ON `vehicle_colour1`.`vehicle_colour_id`=`log_sheet`.`colour_of_vehicle` LEFT JOIN `driver` as driver1 ON `driver1`.`driver_id`=`log_sheet`.`drivers_name_and_surname` LEFT JOIN `fuel_type` as fuel_type1 ON `fuel_type1`.`fuel_type_id`=`log_sheet`.`fuel_type` LEFT JOIN `dealer` as dealer1 ON `dealer1`.`dealer_id`=`gmt_fleet_register1`.`make_of_vehicle` LEFT JOIN `year_model` as year_model1 ON `year_model1`.`year_model_id`=`gmt_fleet_register1`.`year_model_specification` LEFT JOIN `districts` as districts1 ON `districts1`.`district_id`=`gmt_fleet_register1`.`district` LEFT JOIN `province` as province1 ON `province1`.`province_id`=`gmt_fleet_register1`.`province`  WHERE `log_sheet`.`fuel_log_sheet_id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#closing_km<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['closing_km']))); ?>&nbsp;');
			$j('#make_of_vehicle<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['make_of_vehicle']))); ?>&nbsp;');
			$j('#model_of_vehicle<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['model_of_vehicle']))); ?>&nbsp;');
			<?php
			break;

		case 'driver_name_and_surname':
			if(!$id) {
				?>
				$j('#driver_persal_number<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `driver`.`driver_id` as 'driver_id', `driver`.`drivers_name_and_surname` as 'drivers_name_and_surname', `driver`.`drivers_persal_number` as 'drivers_persal_number', CONCAT_WS('-', LEFT(`driver`.`drivers_contact_details`,3), MID(`driver`.`drivers_contact_details`,4,3), RIGHT(`driver`.`drivers_contact_details`,4)) as 'drivers_contact_details', `driver`.`drivers_email_address` as 'drivers_email_address', `driver`.`drivers_license` as 'drivers_license', `driver`.`drivers_license_code` as 'drivers_license_code', `driver`.`drivers_license_number` as 'drivers_license_number', `driver`.`drivers_license_upload` as 'drivers_license_upload', if(`driver`.`drivers_license_expire_date`,date_format(`driver`.`drivers_license_expire_date`,'%d/%m/%Y'),'') as 'drivers_license_expire_date', if(`driver`.`drivers_license_renewal_date`,date_format(`driver`.`drivers_license_renewal_date`,'%d/%m/%Y'),'') as 'drivers_license_renewal_date', `driver`.`drivers_log_history` as 'drivers_log_history', `driver`.`drivers_license_penalties` as 'drivers_license_penalties', if(`driver`.`drivers_license_penalties_date`,date_format(`driver`.`drivers_license_penalties_date`,'%d/%m/%Y'),'') as 'drivers_license_penalties_date', `driver`.`drivers_license_penalty_details` as 'drivers_license_penalty_details', `driver`.`drivers_license_penalty_details_uploads` as 'drivers_license_penalty_details_uploads', `driver`.`involved_in_accident` as 'involved_in_accident', `driver`.`accident_report` as 'accident_report' FROM `driver`  WHERE `driver`.`driver_id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#driver_persal_number<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['drivers_persal_number'].'    |   and    |   '.$row['drivers_license_number']))); ?>&nbsp;');
			<?php
			break;


	}

?>