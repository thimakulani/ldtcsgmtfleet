<?php
// This script and data application were generated by AppGini 22.13
// Download AppGini for free from https://bigprof.com/appgini/download/

	include_once(__DIR__ . '/lib.php');

	handle_maintenance();

	header('Content-type: text/javascript; charset=' . datalist_db_encoding);

	$table_perms = getTablePermissions('authorizations');
	if(!$table_perms['access']) die('// Access denied!');

	$mfk = Request::val('mfk');
	$id = makeSafe(Request::val('id'));
	$rnd1 = intval(Request::val('rnd1')); if(!$rnd1) $rnd1 = '';

	if(!$mfk) {
		die('// No js code available!');
	}

	switch($mfk) {

		case 'job_code':
			if(!$id) {
				?>
				$j('#job_odometer<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#instruction_note<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#pre_authorisation_date<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#make_of_vehicle<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#total_claim<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#total_authorised<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#authorization_number<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `claim`.`claim_id` as 'claim_id', `claim`.`claim_code` as 'claim_code', IF(    CHAR_LENGTH(`claim_status1`.`claim_status`), CONCAT_WS('',   `claim_status1`.`claim_status`), '') as 'claim_status', IF(    CHAR_LENGTH(`claim_category1`.`claim_category`), CONCAT_WS('',   `claim_category1`.`claim_category`), '') as 'claim_category', IF(    CHAR_LENGTH(`cost_centre1`.`cost_centre`), CONCAT_WS('',   `cost_centre1`.`cost_centre`), '') as 'cost_centre', `claim`.`client_identification` as 'client_identification', IF(    CHAR_LENGTH(`departments1`.`department_name`), CONCAT_WS('',   `departments1`.`department_name`), '') as 'department_name', IF(    CHAR_LENGTH(`districts1`.`district`), CONCAT_WS('',   `districts1`.`district`), '') as 'district', IF(    CHAR_LENGTH(`province1`.`province`), CONCAT_WS('',   `province1`.`province`), '') as 'province', IF(    CHAR_LENGTH(`merchant1`.`merchant_name`) || CHAR_LENGTH(`merchant1`.`merchant_code`), CONCAT_WS('',   `merchant1`.`merchant_name`, '     |   and    |   ', `merchant1`.`merchant_code`), '') as 'merchant_name', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`) || CHAR_LENGTH(`gmt_fleet_register1`.`chassis_number`), CONCAT_WS('',   `gmt_fleet_register1`.`vehicle_registration_number`, '    |   and    |  ', `gmt_fleet_register1`.`chassis_number`), '') as 'vehicle_registration_number', IF(    CHAR_LENGTH(`gmt_fleet_register1`.`model_of_vehicle`) || CHAR_LENGTH(`gmt_fleet_register1`.`vehicle_registration_number`), CONCAT_WS('',   `gmt_fleet_register1`.`model_of_vehicle`, ' |   and    |    ', `gmt_fleet_register1`.`vehicle_registration_number`), '') as 'model', IF(    CHAR_LENGTH(`log_sheet1`.`closing_km`), CONCAT_WS('',   `log_sheet1`.`closing_km`), '') as 'closing_km', DATE_FORMAT(`claim`.`pre_authorization_date`, '%D %b %Y %l:%i%p') as 'pre_authorization_date', `claim`.`instruction_note` as 'instruction_note', DATE_FORMAT(`claim`.`invoice_date`, '%D %b %Y %l:%i%p') as 'invoice_date', `claim`.`upload_invoice` as 'upload_invoice', DATE_FORMAT(`claim`.`payment_date`, '%D %b %Y %l:%i%p') as 'payment_date', `claim`.`authorization_number` as 'authorization_number', `claim`.`clearance_number` as 'clearance_number', DATE_FORMAT(`claim`.`vehicle_collected_date`, '%D %b %Y %l:%i%p') as 'vehicle_collected_date', `claim`.`total_claimed` as 'total_claimed', `claim`.`total_authorized` as 'total_authorized' FROM `claim` LEFT JOIN `claim_status` as claim_status1 ON `claim_status1`.`claim_status_id`=`claim`.`claim_status` LEFT JOIN `claim_category` as claim_category1 ON `claim_category1`.`claim_category_id`=`claim`.`claim_category` LEFT JOIN `cost_centre` as cost_centre1 ON `cost_centre1`.`cost_centre_id`=`claim`.`cost_centre` LEFT JOIN `departments` as departments1 ON `departments1`.`department_id`=`claim`.`department_name` LEFT JOIN `districts` as districts1 ON `districts1`.`district_id`=`claim`.`district` LEFT JOIN `province` as province1 ON `province1`.`province_id`=`claim`.`province` LEFT JOIN `merchant` as merchant1 ON `merchant1`.`merchant_id`=`claim`.`merchant_name` LEFT JOIN `gmt_fleet_register` as gmt_fleet_register1 ON `gmt_fleet_register1`.`fleet_asset_id`=`claim`.`vehicle_registration_number` LEFT JOIN `log_sheet` as log_sheet1 ON `log_sheet1`.`fuel_log_sheet_id`=`claim`.`closing_km`  WHERE `claim`.`claim_id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#job_odometer<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['closing_km']))); ?>&nbsp;');
			$j('#instruction_note<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['instruction_note']))); ?>&nbsp;');
			$j('#pre_authorisation_date<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['pre_authorization_date']))); ?>&nbsp;');
			$j('#make_of_vehicle<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['model'].'   |    and    |   '.$row['vehicle_registration_number']))); ?>&nbsp;');
			$j('#total_claim<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['total_claimed']))); ?>&nbsp;');
			$j('#total_authorised<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['total_authorized']))); ?>&nbsp;');
			$j('#authorization_number<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['authorization_number'].'     |   and   |     '.$row['claim_code']))); ?>&nbsp;');
			<?php
			break;

		case 'merchant_code':
			if(!$id) {
				?>
				$j('#merchant_name<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#merchant_contact_email<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#merchant_street_address<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#merchant_suburb<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#merchant_city<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#merchant_address_code<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#merchant_contact_details<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `merchant`.`merchant_id` as 'merchant_id', IF(    CHAR_LENGTH(`merchant_type1`.`merchant_type`), CONCAT_WS('',   `merchant_type1`.`merchant_type`), '') as 'merchant_type', `merchant`.`merchant_code` as 'merchant_code', `merchant`.`merchant_name` as 'merchant_name', `merchant`.`merchant_contact_email` as 'merchant_contact_email', `merchant`.`merchant_street_address` as 'merchant_street_address', `merchant`.`merchant_suburb` as 'merchant_suburb', `merchant`.`merchant_city` as 'merchant_city', `merchant`.`merchant_address_code` as 'merchant_address_code', `merchant`.`merchant_contact_details` as 'merchant_contact_details' FROM `merchant` LEFT JOIN `merchant_type` as merchant_type1 ON `merchant_type1`.`merchant_type_id`=`merchant`.`merchant_type`  WHERE `merchant`.`merchant_id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#merchant_name<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['merchant_name'].'     |     and      |     '.$row['merchant_code']))); ?>&nbsp;');
			$j('#merchant_contact_email<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['merchant_contact_email']))); ?>&nbsp;');
			$j('#merchant_street_address<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['merchant_street_address']))); ?>&nbsp;');
			$j('#merchant_suburb<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['merchant_suburb']))); ?>&nbsp;');
			$j('#merchant_city<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['merchant_city']))); ?>&nbsp;');
			$j('#merchant_address_code<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['merchant_address_code']))); ?>&nbsp;');
			$j('#merchant_contact_details<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['merchant_contact_details']))); ?>&nbsp;');
			<?php
			break;


	}

?>